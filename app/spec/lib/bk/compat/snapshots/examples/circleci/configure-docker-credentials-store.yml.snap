---
steps:
- commands:
  - "# No need for checkout, the agent takes care of that"
  - echo '~~~ Install Dependencies'
  - apt-get update
  - apt-get install -y curl jq
  - echo '~~~ Configuring Docker Credentials Store'
  - DOCKER_CONFIG_PATH="$HOME/.docker/config.json"
  - HELPER_NAME=""
  - if [ -z "$HELPER_NAME" ]; then
  - '  if [ "$(uname -s)" = "Darwin" ]; then'
  - '    HELPER_NAME="osxkeychain"'
  - "  else"
  - '    HELPER_NAME="pass"'
  - "  fi"
  - fi
  - if [ ! -e "$DOCKER_CONFIG_PATH" ]; then
  - '  mkdir -p "$(dirname "$DOCKER_CONFIG_PATH")"'
  - fi
  - if ! command -v jq >/dev/null 2>&1; then
  - '  echo "jq is required for this command"'
  - "  exit 1"
  - fi
  - 'jq --arg credsStore "$HELPER_NAME" ''. + {credsStore: $credsStore}'' "$DOCKER_CONFIG_PATH"
    > /tmp/docker-config-credsstore-update.json'
  - mv /tmp/docker-config-credsstore-update.json "$DOCKER_CONFIG_PATH"
  plugins:
  - docker#v5.10.0:
      image: cimg/base:stable
  agents:
    executor_type: docker
  key: configure-docker-credentials-store
- commands:
  - "# No need for checkout, the agent takes care of that"
  - echo '~~~ Install Dependencies'
  - apt-get update
  - apt-get install -y curl jq
  - echo '~~~ Configuring Docker Credentials Store'
  - DOCKER_CONFIG_PATH="/custom/path/.docker/config.json"
  - HELPER_NAME="pass"
  - if [ -z "$HELPER_NAME" ]; then
  - '  if [ "$(uname -s)" = "Darwin" ]; then'
  - '    HELPER_NAME="osxkeychain"'
  - "  else"
  - '    HELPER_NAME="pass"'
  - "  fi"
  - fi
  - if [ ! -e "$DOCKER_CONFIG_PATH" ]; then
  - '  mkdir -p "$(dirname "$DOCKER_CONFIG_PATH")"'
  - fi
  - if ! command -v jq >/dev/null 2>&1; then
  - '  echo "jq is required for this command"'
  - "  exit 1"
  - fi
  - 'jq --arg credsStore "$HELPER_NAME" ''. + {credsStore: $credsStore}'' "$DOCKER_CONFIG_PATH"
    > /tmp/docker-config-credsstore-update.json'
  - mv /tmp/docker-config-credsstore-update.json "$DOCKER_CONFIG_PATH"
  plugins:
  - docker#v5.10.0:
      image: cimg/base:stable
  agents:
    executor_type: docker
  key: configure-docker-credentials-store-custom
