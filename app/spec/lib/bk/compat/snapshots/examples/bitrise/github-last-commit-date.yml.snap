---
steps:
- commands:
  - "# No need for cloning, the agent takes care of that"
  - git clone --depth 1 https://github.com/bitrise-io/bitrise-steplib.git $(mktemp
    -d)
  - cd $(mktemp -d)
  - LAST_COMMIT_DATE=$(git log -1 --format=%ci)
  - |-
    if [[ "$(uname)" == "Darwin" ]]; then
      LAST_COMMIT_DATE_NUMBERS=$(date -j -f "%Y-%m-%d %H:%M:%S %z" "$LAST_COMMIT_DATE" +'%y%m%d%H%M')
    else
      LAST_COMMIT_DATE_NUMBERS=$(date -d "$LAST_COMMIT_DATE" +'%y%m%d%H%M')
    fi
  - echo "LAST_COMMIT_DATE=$LAST_COMMIT_DATE" >> $BUILDKITE_ENV
  - echo "LAST_COMMIT_DATE_NUMBERS=$LAST_COMMIT_DATE_NUMBERS" >> $BUILDKITE_ENV
  label: fetch-last-commit-date
  key: fetch-last-commit-date
