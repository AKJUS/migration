---
steps:
- commands:
  - "# No need for cloning, the agent takes care of that"
  - "./build-app.sh"
  - "# SECURITY NOTE: Storing API token in environment variable"
  - export GITHUB_API_TOKEN='$GITHUB_TOKEN'
  - |-
    curl -X POST \
    -H "Authorization: token $GITHUB_API_TOKEN" \
    -H "Accept: application/vnd.github.v3+json" \
    -H "Content-Type: application/octet-stream" \
    --data-binary @/tmp/bitrise-ex/artifacts/app-debug.apk \
    https://uploads.github.com/repos/["example", "example-repository"]/releases/assets?name=app-debug.apk
  - |-
    curl -X POST \
    -H "Authorization: token $GITHUB_API_TOKEN" \
    -H "Accept: application/vnd.github.v3+json" \
    -H "Content-Type: application/octet-stream" \
    --data-binary @/tmp/bitrise-ex/artifacts/app-debug-androidTest.apk \
    https://uploads.github.com/repos/["example", "example-repository"]/releases/assets?name=app-debug-androidTest.apk
  - |-
    curl -X POST \
    -H "Authorization: token $GITHUB_API_TOKEN" \
    -H "Accept: application/vnd.github.v3+json" \
    -H "Content-Type: application/octet-stream" \
    --data-binary @/tmp/bitrise-ex/artifacts/no-alt-filename.apk \
    https://uploads.github.com/repos/["example", "example-repository"]/releases/assets?name=$(basename /tmp/bitrise-ex/artifacts/no-alt-filename.apk)
  - |-
    curl -X POST \
    -H "Authorization: token $GITHUB_API_TOKEN" \
    -H "Accept: application/vnd.github.v3+json" \
    -H "Content-Type: application/octet-stream" \
    --data-binary @/tmp/bitrise-ex/artifacts/${APP_NAME}-debug.apk \
    https://uploads.github.com/repos/["example", "example-repository"]/releases/assets?name=$(basename /tmp/bitrise-ex/artifacts/${APP_NAME}-debug.apk)
  - |-
    curl -X POST \
    -H "Authorization: token $GITHUB_API_TOKEN" \
    -H "Accept: application/vnd.github.v3+json" \
    -H "Content-Type: application/octet-stream" \
    --data-binary @/tmp/bitrise-ex/artifacts/${APP_NAME}-debug-androidTest.apk \
    https://uploads.github.com/repos/["example", "example-repository"]/releases/assets?name=$(basename /tmp/bitrise-ex/artifacts/${APP_NAME}-debug-androidTest.apk)
  - |-
    curl -X POST \
    -H "Authorization: token $GITHUB_API_TOKEN" \
    -H "Accept: application/vnd.github.v3+json" \
    -H "Content-Type: application/octet-stream" \
    --data-binary @/tmp/bitrise-ex/artifacts/app-debug.apk \
    https://uploads.github.com/repos/["example", "example-repository"]/releases/assets?name=${APP_NAME}-debug.apk
  - |-
    curl -X POST \
    -H "Authorization: token $GITHUB_API_TOKEN" \
    -H "Accept: application/vnd.github.v3+json" \
    -H "Content-Type: application/octet-stream" \
    --data-binary @/tmp/bitrise-ex/artifacts/app-debug-androidTest.apk \
    https://uploads.github.com/repos/["example", "example-repository"]/releases/assets?name=${APP_NAME}-debug-androidTest.apk
  label: build
  key: build
- commands:
  - "# No need for cloning, the agent takes care of that"
  - "# SECURITY NOTE: Storing API token in environment variable"
  - export GITHUB_API_TOKEN='$GITHUB_TOKEN'
  - |-
    curl -X POST \
    -H "Authorization: token $GITHUB_API_TOKEN" \
    -H "Accept: application/vnd.github.v3+json" \
    -H "Content-Type: application/octet-stream" \
    --data-binary @/tmp/bitrise-ex/artifacts/app-debug.apk \
    https://uploads.github.com/repos/["example", "example-repository"]/releases/assets?name=app-debug.apk
  - |-
    curl -X POST \
    -H "Authorization: token $GITHUB_API_TOKEN" \
    -H "Accept: application/vnd.github.v3+json" \
    -H "Content-Type: application/octet-stream" \
    --data-binary @/tmp/bitrise-ex/artifacts/app-debug-androidTest.apk \
    https://uploads.github.com/repos/["example", "example-repository"]/releases/assets?name=app-debug-androidTest.apk
  - |-
    curl -X POST \
    -H "Authorization: token $GITHUB_API_TOKEN" \
    -H "Accept: application/vnd.github.v3+json" \
    -H "Content-Type: application/octet-stream" \
    --data-binary @/tmp/bitrise-ex/artifacts/no-alt-filename.apk \
    https://uploads.github.com/repos/["example", "example-repository"]/releases/assets?name=$(basename /tmp/bitrise-ex/artifacts/no-alt-filename.apk)
  - |-
    curl -X POST \
    -H "Authorization: token $GITHUB_API_TOKEN" \
    -H "Accept: application/vnd.github.v3+json" \
    -H "Content-Type: application/octet-stream" \
    --data-binary @/tmp/bitrise-ex/artifacts/${APP_NAME}-debug.apk \
    https://uploads.github.com/repos/["example", "example-repository"]/releases/assets?name=$(basename /tmp/bitrise-ex/artifacts/${APP_NAME}-debug.apk)
  - |-
    curl -X POST \
    -H "Authorization: token $GITHUB_API_TOKEN" \
    -H "Accept: application/vnd.github.v3+json" \
    -H "Content-Type: application/octet-stream" \
    --data-binary @/tmp/bitrise-ex/artifacts/${APP_NAME}-debug-androidTest.apk \
    https://uploads.github.com/repos/["example", "example-repository"]/releases/assets?name=$(basename /tmp/bitrise-ex/artifacts/${APP_NAME}-debug-androidTest.apk)
  - |-
    curl -X POST \
    -H "Authorization: token $GITHUB_API_TOKEN" \
    -H "Accept: application/vnd.github.v3+json" \
    -H "Content-Type: application/octet-stream" \
    --data-binary @/tmp/bitrise-ex/artifacts/app-debug.apk \
    https://uploads.github.com/repos/["example", "example-repository"]/releases/assets?name=${APP_NAME}-debug.apk
  - |-
    curl -X POST \
    -H "Authorization: token $GITHUB_API_TOKEN" \
    -H "Accept: application/vnd.github.v3+json" \
    -H "Content-Type: application/octet-stream" \
    --data-binary @/tmp/bitrise-ex/artifacts/app-debug-androidTest.apk \
    https://uploads.github.com/repos/["example", "example-repository"]/releases/assets?name=${APP_NAME}-debug-androidTest.apk
  label: test
  key: test
