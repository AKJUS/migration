---
steps:
- commands:
  - "# No need for checkout, the agent takes care of that"
  - "./scripts/build-package.sh"
  plugins:
  - docker#v5.10.0:
      image: cimg/base:stable
      environment:
      - DEPLOY_ENV
  agents:
    executor_type: docker
  env:
    DEPLOY_ENV: staging
  key: build-and-package
  if: '"RELEASE_STAGING" == "true"'
- block: gate
  key: gate
  depends_on:
  - build-and-package
  if: '"RELEASE_STAGING" == "true"'
- commands:
  - "# No need for checkout, the agent takes care of that"
  - echo '~~~ Publish binary'
  - "./scripts/publish.sh"
  - cd ~/repo
  plugins:
  - docker#v5.10.0:
      image: cimg/base:stable
      environment:
      - DEPLOY_ENV
  agents:
    executor_type: docker
  env:
    DEPLOY_ENV: staging
  key: publish
  if: '"RELEASE_STAGING" == "true"'
